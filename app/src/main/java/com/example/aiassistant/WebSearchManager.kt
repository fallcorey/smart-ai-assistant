package com.example.aiassistant

import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import org.jsoup.Jsoup
import java.net.URLEncoder

class WebSearchManager {
    
    suspend fun searchWeb(query: String): String = withContext(Dispatchers.IO) {
        return@withContext try {
            if (query.length < 2) {
                return@withContext "‚ùå –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å. –£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –≤—ã –∏—â–µ—Ç–µ."
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ DuckDuckGo
            val encodedQuery = URLEncoder.encode(query, "UTF-8")
            val searchUrl = "https://lite.duckduckgo.com/lite/?q=$encodedQuery"
            
            val doc = Jsoup.connect(searchUrl)
                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
                .timeout(20000)
                .get()
            
            val results = doc.select(".result-link")
            val snippets = doc.select(".result-snippet")
            
            if (results.isNotEmpty()) {
                val topResults = results.take(3).mapIndexed { index, element ->
                    val title = element.text()
                    val snippet = if (snippets.size > index) {
                        val text = snippets[index].text()
                        if (text.length > 150) text.substring(0, 150) + "..." else text
                    } else {
                        "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
                    }
                    "‚Ä¢ **$title**\n  $snippet"
                }
                
                "üîç **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É \"$query\":**\n\n${topResults.joinToString("\n\n")}"
            } else {
                // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
                getLocalSearchResults(query)
            }
        } catch (e: Exception) {
            "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. ${e.message ?: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"}\n\n${getLocalSearchResults(query)}"
        }
    }
    
    private fun getLocalSearchResults(query: String): String {
        val localKnowledge = mapOf(
            "–∫–æ—à–∫–∏" to "–ö–æ—à–∫–∏ ‚Äî –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ, –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏–µ —Å–µ–º–µ–π—Å—Ç–≤–∞ –∫–æ—à–∞—á—å–∏—Ö. –ò–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π –≥—Ä–∞—Ü–∏–µ–π –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é.",
            "—Å–æ–±–∞–∫–∏" to "–°–æ–±–∞–∫–∏ ‚Äî –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ, –ª—É—á—à–∏–µ –¥—Ä—É–∑—å—è —á–µ–ª–æ–≤–µ–∫–∞. –ò–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å—é –∏ —É–º–æ–º.",
            "–ø–æ–≥–æ–¥–∞" to "–ü–æ–≥–æ–¥–∞ ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –í–∫–ª—é—á–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –≤–ª–∞–∂–Ω–æ—Å—Ç—å, –≤–µ—Ç–µ—Ä.",
            "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" to "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ‚Äî –º–µ—Ç–æ–¥—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥. –í–∫–ª—é—á–∞—é—Ç IT, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫—É, AI.",
            "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" to "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.",
            "android" to "Android ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è Google –Ω–∞ –æ—Å–Ω–æ–≤–µ Linux.",
            "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" to "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (AI) ‚Äî –æ–±–ª–∞—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –Ω–∞—É–∫, –∑–∞–Ω–∏–º–∞—é—â–∞—è—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º —É–º–Ω—ã—Ö –º–∞—à–∏–Ω.",
            "–∫–æ—Å–º–æ—Å" to "–ö–æ—Å–º–æ—Å ‚Äî –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∑–µ–º–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã. –í–∫–ª—é—á–∞–µ—Ç –∑–≤–µ–∑–¥—ã, –ø–ª–∞–Ω–µ—Ç—ã, –≥–∞–ª–∞–∫—Ç–∏–∫–∏.",
            "—Å–ø–æ—Ä—Ç" to "–°–ø–æ—Ä—Ç ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –æ–±—ã—á–Ω–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.",
            "–º—É–∑—ã–∫–∞" to "–ú—É–∑—ã–∫–∞ ‚Äî –∏—Å–∫—É—Å—Å—Ç–≤–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–≤—É–∫–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –í–∫–ª—é—á–∞–µ—Ç —Ä–∏—Ç–º, –º–µ–ª–æ–¥–∏—é, –≥–∞—Ä–º–æ–Ω–∏—é."
        )
        
        val lowercaseQuery = query.lowercase()
        val result = localKnowledge.entries.find { (key, _) -> 
            lowercaseQuery.contains(key) 
        }?.value
        
        return if (result != null) {
            "üìö **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É \"$query\":**\n\n$result"
        } else {
            "‚ùå –ü–æ –∑–∞–ø—Ä–æ—Å—É \"$query\" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å."
        }
    }
    
    suspend fun getQuickAnswer(question: String): String = withContext(Dispatchers.IO) {
        return@withContext try {
            // –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
            val knowledgeBase = mapOf(
                "—á—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" to "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–ò–ò) ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É—é—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞: –æ–±—É—á–µ–Ω–∏–µ, —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" to "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º —Å –ø–æ–º–æ—â—å—é —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø–∏—à—É—Ç –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç.",
                "–∫—Ç–æ —Ç–∞–∫–æ–π –ø—É—Ç–∏–Ω" to "–í–ª–∞–¥–∏–º–∏—Ä –ü—É—Ç–∏–Ω ‚Äî —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–µ—è—Ç–µ–ª—å, –∑–∞–Ω–∏–º–∞—é—â–∏–π –≤—ã—Å—à–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–µ –†–æ—Å—Å–∏–∏.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ android" to "Android ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏–µ–π Google. –û—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ —è–¥—Ä–µ Linux.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ kotlin" to "Kotlin ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω JetBrains.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ java" to "Java ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ó–Ω–∞–º–µ–Ω–∏—Ç –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å—é.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ python" to "Python ‚Äî —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–≤–æ–µ–π –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ —à–∏—Ä–æ–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≤ data science –∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.",
                "–∫—Ç–æ —Ç–∞–∫–æ–π —ç–π–Ω—à—Ç–µ–π–Ω" to "–ê–ª—å–±–µ—Ä—Ç –≠–π–Ω—à—Ç–µ–π–Ω ‚Äî —Ñ–∏–∑–∏–∫-—Ç–µ–æ—Ä–µ—Ç–∏–∫, –æ–¥–∏–Ω –∏–∑ –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π —Ñ–∏–∑–∏–∫–∏. –ê–≤—Ç–æ—Ä —Ç–µ–æ—Ä–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è" to "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è ‚Äî —ç—Ç–æ —Å–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–º–∏ —Ç–µ–ª–∞–º–∏ –≤–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π. –û—Ç–∫—Ä—ã—Ç–∞ –ò—Å–∞–∞–∫–æ–º –ù—å—é—Ç–æ–Ω–æ–º.",
                "—á—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç" to "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî –≤—Å–µ–º–∏—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ TCP/IP."
            )
            
            val lowercaseQuestion = question.lowercase()
            val answer = knowledgeBase.entries.find { (key, _) -> 
                lowercaseQuestion.contains(key) 
            }?.value
            
            if (answer != null) {
                "üéØ **–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å:**\n\n$answer"
            } else {
                "‚ùå –ù–µ –Ω–∞—à–µ–ª —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –≤ –º–æ–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∏—Å–∫–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: '–ù–∞–π–¥–∏ $question'"
            }
        } catch (e: Exception) {
            "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ—Ç–≤–µ—Ç–∞: ${e.message}"
        }
    }
    
    suspend fun getNews(topic: String = "–Ω–æ–≤–æ—Å—Ç–∏"): String = withContext(Dispatchers.IO) {
        return@withContext try {
            // –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–µ–º–∞–º
            val newsTopics = mapOf(
                "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" to listOf(
                    "‚Ä¢ **–ù–æ–≤—ã–µ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã** —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏ –∏ –±—ã—Å—Ç—Ä–æ–π –∑–∞—Ä—è–¥–∫–æ–π",
                    "‚Ä¢ **–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç** –ø–æ–º–æ–≥–∞–µ—Ç –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ", 
                    "‚Ä¢ **–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã** —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –±–æ–ª–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏",
                    "‚Ä¢ **–ë–µ—Å–ø–∏–ª–æ—Ç–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏** –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
                    "‚Ä¢ **VR –∏ AR —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏** –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏"
                ),
                "—Å–ø–æ—Ä—Ç" to listOf(
                    "‚Ä¢ **–§—É—Ç–±–æ–ª—å–Ω—ã–µ –º–∞—Ç—á–∏** —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞ –º–∏—Ä–∞ —Å–æ–±–∏—Ä–∞—é—Ç –º–∏–ª–ª–∏–æ–Ω—ã –∑—Ä–∏—Ç–µ–ª–µ–π",
                    "‚Ä¢ **–û–ª–∏–º–ø–∏–π—Å–∫–∏–µ –∏–≥—Ä—ã** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –Ω–æ–≤—ã–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã",
                    "‚Ä¢ **–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç** –ø—Ä–∏–∑–Ω–∞–Ω –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –≤–∏–¥–æ–º —Å–ø–æ—Ä—Ç–∞ –≤–æ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö",
                    "‚Ä¢ **–ù–æ–≤—ã–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏—è** —Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É",
                    "‚Ä¢ **–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏** —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å–µ –±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º"
                ),
                "–ø–æ–ª–∏—Ç–∏–∫–∞" to listOf(
                    "‚Ä¢ **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏** –æ–±—Å—É–∂–¥–∞—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
                    "‚Ä¢ **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ** —É–∫—Ä–µ–ø–ª—è–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∞–º–∏",
                    "‚Ä¢ **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã** –ø–æ–º–æ–≥–∞—é—Ç –Ω—É–∂–¥–∞—é—â–∏–º—Å—è —Å–ª–æ—è–º –Ω–∞—Å–µ–ª–µ–Ω–∏—è", 
                    "‚Ä¢ **–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã** –±–æ—Ä—é—Ç—Å—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–ª–∏–º–∞—Ç–∞",
                    "‚Ä¢ **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã** –ø–æ–ª—É—á–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ"
                ),
                "–Ω–∞—É–∫–∞" to listOf(
                    "‚Ä¢ **–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è** –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –Ω–æ–≤—ã–µ –ø–ª–∞–Ω–µ—Ç—ã",
                    "‚Ä¢ **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è** –ø–æ–º–æ–≥–∞—é—Ç –≤ –ª–µ—á–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π",
                    "‚Ä¢ **–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞** —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è —Å–µ–º–∏–º–∏–ª—å–Ω—ã–º–∏ —à–∞–≥–∞–º–∏",
                    "‚Ä¢ **–ë–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏** —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
                    "‚Ä¢ **–§–∏–∑–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è** —É–≥–ª—É–±–ª—è—é—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤—Å–µ–ª–µ–Ω–Ω–æ–π"
                )
            )
            
            val topicKey = newsTopics.keys.find { topic.contains(it) } ?: "–æ–±—â–∏–µ"
            
            val newsList = when (topicKey) {
                "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" -> newsTopics["—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"]!!
                "—Å–ø–æ—Ä—Ç" -> newsTopics["—Å–ø–æ—Ä—Ç"]!!
                "–ø–æ–ª–∏—Ç–∏–∫–∞" -> newsTopics["–ø–æ–ª–∏—Ç–∏–∫–∞"]!!
                "–Ω–∞—É–∫–∞" -> newsTopics["–Ω–∞—É–∫–∞"]!!
                else -> listOf(
                    "‚Ä¢ **–†–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π** –º–µ–Ω—è–µ—Ç –Ω–∞—à—É –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—É—é –∂–∏–∑–Ω—å",
                    "‚Ä¢ **–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –ª—é–¥–µ–π –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É", 
                    "‚Ä¢ **–ù–∞—É—á–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è** —Ä–∞—Å—à–∏—Ä—è—é—Ç –≥—Ä–∞–Ω–∏—Ü—ã —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –∑–Ω–∞–Ω–∏–π",
                    "‚Ä¢ **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã** —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –±–æ–ª–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏",
                    "‚Ä¢ **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã** —É–ª—É—á—à–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏"
                )
            }
            
            "üì∞ **–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–µ–º–µ \"$topic\":**\n\n${newsList.joinToString("\n\n")}"
        } catch (e: Exception) {
            "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏. ${e.message}"
        }
    }
    
    suspend fun getWeather(city: String = "–ú–æ—Å–∫–≤–∞"): String = withContext(Dispatchers.IO) {
        return@withContext try {
            // –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
            val weatherData = mapOf(
                "–º–æ—Å–∫–≤–∞" to "üå§Ô∏è **–ü–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç +3¬∞C –¥–æ +10¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 70%\n‚Ä¢ –í–µ—Ç–µ—Ä: 4 –º/—Å\n‚Ä¢ –û–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏",
                "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥" to "üåßÔ∏è **–ü–æ–≥–æ–¥–∞ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç +2¬∞C –¥–æ +8¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 80%\n‚Ä¢ –í–µ—Ç–µ—Ä: 5 –º/—Å\n‚Ä¢ –ü–∞—Å–º—É—Ä–Ω–æ, –≤–æ–∑–º–æ–∂–µ–Ω –¥–æ–∂–¥—å",
                "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫" to "‚ùÑÔ∏è **–ü–æ–≥–æ–¥–∞ –≤ –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–µ:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç -5¬∞C –¥–æ +2¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 65%\n‚Ä¢ –í–µ—Ç–µ—Ä: 3 –º/—Å\n‚Ä¢ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å",
                "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥" to "üå•Ô∏è **–ü–æ–≥–æ–¥–∞ –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–µ:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç -2¬∞C –¥–æ +5¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 75%\n‚Ä¢ –í–µ—Ç–µ—Ä: 4 –º/—Å\n‚Ä¢ –ù–µ–±–æ–ª—å—à–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å",
                "–∫–∞–∑–∞–Ω—å" to "üå§Ô∏è **–ü–æ–≥–æ–¥–∞ –≤ –ö–∞–∑–∞–Ω–∏:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç +1¬∞C –¥–æ +7¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 68%\n‚Ä¢ –í–µ—Ç–µ—Ä: 3 –º/—Å\n‚Ä¢ –°–æ–ª–Ω–µ—á–Ω–æ"
            )
            
            val lowercaseCity = city.lowercase()
            val weather = weatherData.entries.find { (key, _) -> 
                lowercaseCity.contains(key) 
            }?.value
            
            weather ?: "üå§Ô∏è **–ü–æ–≥–æ–¥–∞ –≤ $city:**\n\n‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: –æ—Ç +5¬∞C –¥–æ +12¬∞C\n‚Ä¢ –í–ª–∞–∂–Ω–æ—Å—Ç—å: 65%\n‚Ä¢ –í–µ—Ç–µ—Ä: 3 –º/—Å\n‚Ä¢ –û–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏\n\n*–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã.*"
        } catch (e: Exception) {
            "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ. ${e.message}"
        }
    }
}
